<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教學訓練計畫主持人工作坊報名表</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    // 定義莫蘭迪藍色系 (使用 Tailwind 的 indigo 和 blue-gray 搭配)
                    colors: {
                        'morandi-blue': {
                            50: '#f0f4f8',
                            100: '#e1e7f0',
                            200: '#c5d1e0',
                            300: '#a7bace',
                            400: '#89a0ba',
                            500: '#6a86a6', // 主要底色
                            600: '#4d6c92', // 按鈕/強調色
                            700: '#345279',
                            800: '#1b3861',
                            900: '#001e48',
                        },
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        /* 確保 body 背景使用柔和的淺藍色 */
        body {
            background-color: #f0f4f8; /* Morandi Blue 50 */
        }
        /* 自定義焦點樣式 */
        .form-input:focus {
            border-color: #6a86a6; /* Morandi Blue 500 */
            box-shadow: 0 0 0 3px rgba(106, 134, 166, 0.5);
            outline: none;
        }
    </style>
</head>
<body class="font-sans antialiased text-gray-800">

    <!-- 全局提示框 -->
    <div id="message-box" class="fixed top-0 left-1/2 transform -translate-x-1/2 z-50 transition-opacity duration-300 ease-in-out opacity-0 pointer-events-none p-3 w-full max-w-sm">
        <div id="message-content" class="rounded-lg shadow-lg text-sm px-4 py-3 text-white"></div>
    </div>

    <!-- 函數：顯示全局訊息 -->
    <script>
        function showMessage(message, type = 'success') {
            const box = document.getElementById('message-box');
            const content = document.getElementById('message-content');
            
            content.textContent = message;
            box.classList.remove('opacity-0', 'pointer-events-none');
            
            // 設置顏色
            if (type === 'success') {
                content.className = 'rounded-lg shadow-lg text-sm px-4 py-3 text-white bg-morandi-blue-600';
            } else if (type === 'error') {
                content.className = 'rounded-lg shadow-lg text-sm px-4 py-3 text-white bg-red-500';
            }

            setTimeout(() => {
                box.classList.add('opacity-0', 'pointer-events-none');
            }, 3000);
        }
    </script>

    <!-- 容器：置中並設定最大寬度 -->
    <div class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- 卡片區塊：整體報名表容器 -->
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden border border-morandi-blue-200">

            <!-- 標題區塊 -->
            <header class="bg-morandi-blue-500 p-6 sm:p-8 text-white">
                <h1 class="text-3xl font-bold mb-1">教學訓練計畫主持人工作坊報名</h1>
                <p class="text-morandi-blue-100 text-sm sm:text-base">Training Program Director Workshop Registration Form</p>
            </header>

            <!-- 內容區塊 -->
            <div class="p-6 sm:p-8 lg:p-10 space-y-8">

                <!-- 活動資訊區塊 -->
                <section class="bg-morandi-blue-100 p-4 sm:p-6 rounded-lg border-l-4 border-morandi-blue-600 shadow-inner">
                    <h2 class="text-xl font-semibold mb-3 text-morandi-blue-700">【活動資訊】</h2>
                    <ul class="text-sm space-y-1.5 text-gray-700">
                        <li><span class="font-medium text-morandi-blue-600">日期：</span>2026/06/22</li>
                        <li><span class="font-medium text-morandi-blue-600">時間：</span>9:00 ~ 16:00</li>
                        <li><span class="font-medium text-morandi-blue-600">地點：</span>奇美醫院第五醫療大樓6樓563會議室</li>
                    </ul>
                </section>

                <!-- 報名表單區塊 -->
                <form id="registrationForm" class="space-y-6">
                    <h2 class="text-2xl font-semibold border-b pb-3 text-morandi-blue-800">【報名表單】</h2>

                    <!-- 欄位：姓名 -->
                    <div>
                        <label for="name" class="block text-sm font-medium text-morandi-blue-700 mb-1">姓名 <span class="text-red-500">*</span></label>
                        <input type="text" id="name" name="name" required
                               class="form-input w-full px-4 py-2 border border-morandi-blue-300 rounded-lg focus:ring-morandi-blue-500 focus:border-morandi-blue-500 transition duration-150">
                    </div>

                    <!-- 欄位：機構名 -->
                    <div>
                        <label for="institution" class="block text-sm font-medium text-morandi-blue-700 mb-1">您的機構名 <span class="text-red-500">*</span></label>
                        <input type="text" id="institution" name="institution" required
                               class="form-input w-full px-4 py-2 border border-morandi-blue-300 rounded-lg focus:ring-morandi-blue-500 focus:border-morandi-blue-500 transition duration-150">
                    </div>

                    <!-- 欄位：職類 (下拉式選單) -->
                    <div>
                        <label for="profession" class="block text-sm font-medium text-morandi-blue-700 mb-1">您負責的職類 <span class="text-red-500">*</span></label>
                        <select id="profession" name="profession" required
                                class="form-input w-full px-4 py-2 border border-morandi-blue-300 rounded-lg bg-white focus:ring-morandi-blue-500 focus:border-morandi-blue-500 transition duration-150 appearance-none">
                            <option value="" disabled selected>請選擇職類</option>
                            <option value="藥事">藥事</option>
                            <option value="醫事放射">醫事放射</option>
                            <option value="醫事檢驗">醫事檢驗</option>
                            <option value="護理">護理</option>
                            <option value="營養">營養</option>
                            <option value="呼吸治療">呼吸治療</option>
                            <option value="聽力">聽力</option>
                            <option value="物理治療">物理治療</option>
                            <option value="職能治療">職能治療</option>
                            <option value="臨床心理">臨床心理</option>
                            <option value="語言治療">語言治療</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>

                    <!-- 欄位：職稱 -->
                    <div>
                        <label for="title" class="block text-sm font-medium text-morandi-blue-700 mb-1">您的職稱 <span class="text-red-500">*</span></label>
                        <input type="text" id="title" name="title" required
                               class="form-input w-full px-4 py-2 border border-morandi-blue-300 rounded-lg focus:ring-morandi-blue-500 focus:border-morandi-blue-500 transition duration-150">
                    </div>

                    <!-- 欄位：是否擔任計畫主持人 (選項二擇一) -->
                    <fieldset>
                        <legend class="block text-sm font-medium text-morandi-blue-700 mb-2">您目前是否擔任教學訓練計畫主持人 <span class="text-red-500">*</span></legend>
                        <div class="mt-2 space-y-2 flex flex-col sm:flex-row sm:space-y-0 sm:space-x-6">
                            <label class="flex items-center text-gray-700">
                                <input type="radio" name="is_director" value="是" required
                                       class="form-radio h-4 w-4 text-morandi-blue-600 border-morandi-blue-300 focus:ring-morandi-blue-500">
                                <span class="ml-2">是</span>
                            </label>
                            <label class="flex items-center text-gray-700">
                                <input type="radio" name="is_director" value="否" required
                                       class="form-radio h-4 w-4 text-morandi-blue-600 border-morandi-blue-300 focus:ring-morandi-blue-500">
                                <span class="ml-2">否</span>
                            </label>
                        </div>
                    </fieldset>

                    <!-- 欄位：預計參與方式 (選項二擇一) -->
                    <fieldset>
                        <legend class="block text-sm font-medium text-morandi-blue-700 mb-2">您預計以何種方式參與 <span class="text-red-500">*</span></legend>
                        <div class="mt-2 space-y-2 flex flex-col sm:flex-row sm:space-y-0 sm:space-x-6">
                            <label class="flex items-center text-gray-700">
                                <input type="radio" name="participation_method" value="實體" required
                                       class="form-radio h-4 w-4 text-morandi-blue-600 border-morandi-blue-300 focus:ring-morandi-blue-500">
                                <span class="ml-2">實體</span>
                            </label>
                            <label class="flex items-center text-gray-700">
                                <input type="radio" name="participation_method" value="線上" required
                                       class="form-radio h-4 w-4 text-morandi-blue-600 border-morandi-blue-300 focus:ring-morandi-blue-500">
                                <span class="ml-2">線上</span>
                            </label>
                        </div>
                    </fieldset>

                    <!-- 欄位：Email -->
                    <div>
                        <label for="email" class="block text-sm font-medium text-morandi-blue-700 mb-1">您的 Email <span class="text-red-500">*</span></label>
                        <input type="email" id="email" name="email" required
                               class="form-input w-full px-4 py-2 border border-morandi-blue-300 rounded-lg focus:ring-morandi-blue-500 focus:border-morandi-blue-500 transition duration-150"
                               placeholder="example@example.com">
                    </div>

                    <!-- 欄位：聯繫電話 -->
                    <div>
                        <label for="phone" class="block text-sm font-medium text-morandi-blue-700 mb-1">您的聯繫電話 <span class="text-red-500">*</span></label>
                        <input type="tel" id="phone" name="phone" required
                               class="form-input w-full px-4 py-2 border border-morandi-blue-300 rounded-lg focus:ring-morandi-blue-500 focus:border-morandi-blue-500 transition duration-150"
                               placeholder="09xx-xxxxxx 或 02-xxxxxx">
                    </div>

                    <!-- 提交按鈕 -->
                    <button type="submit" id="submitButton"
                            class="w-full bg-morandi-blue-600 text-white py-3 px-6 rounded-lg font-semibold text-lg hover:bg-morandi-blue-700 transition duration-200 shadow-md hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-morandi-blue-300">
                        提交報名表
                    </button>
                    <p id="loadingMessage" class="text-center text-morandi-blue-600 hidden mt-2">資料提交中，請稍候...</p>

                </form>

                <!-- 頁尾聯絡資訊 -->
                <footer class="text-center pt-4 border-t border-morandi-blue-200 text-sm text-gray-500">
                    <p>主辦單位：奇美醫院教學部</p>
                    <p>聯絡人：陳大頭 (分機 57439)</p>
                    <p>聯繫電話：06-281-2811</p>
                </footer>

            </div>
        </div>
    </div>

    <!-- JavaScript 處理表單提交 -->
    <script>
        // 您的 Google Apps Script Web App URL
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwwm9_eRf5B8zUz4KhcVyz1QhTysBJLhZGgK1PJP1ww1CGKQCv5natO0ROd51ZLXipv_A/exec";

        const form = document.getElementById('registrationForm');
        const submitButton = document.getElementById('submitButton');
        const loadingMessage = document.getElementById('loadingMessage');

        // 處理表單提交
        form.addEventListener('submit', handleSubmit);

        async function handleSubmit(event) {
            event.preventDefault();

            // 禁用按鈕並顯示載入訊息
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            loadingMessage.classList.remove('hidden');

            try {
                // 1. 手動收集數據，避免 FormData 兼容性問題
                const data = {
                    name: document.getElementById('name').value,
                    institution: document.getElementById('institution').value,
                    profession: document.getElementById('profession').value,
                    title: document.getElementById('title').value,
                    // 由於 radio button group 只有一個 name，我們使用 querySelector 獲取選中的值
                    is_director: form.querySelector('input[name="is_director"]:checked')?.value || '',
                    participation_method: form.querySelector('input[name="participation_method"]:checked')?.value || '',
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                };

                // 2. 將數據轉換為 URLSearchParams 格式
                const formData = new URLSearchParams(data);

                // 3. 發送 POST 請求
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    // 不設定 Content-Type 標頭，讓瀏覽器自動處理，確保發送 application/x-www-form-urlencoded 格式
                    body: formData
                });

                // 檢查網路連線錯誤
                if (!response.ok) {
                    throw new Error(`HTTP Error! Status: ${response.status}`);
                }

                // 讀取回應文本
                const rawText = await response.text();
                
                let result;
                try {
                    // 嘗試解析 JSON (Apps Script 回應)
                    result = JSON.parse(rawText);
                } catch (parseError) {
                    // 如果解析失敗，表示 Apps Script 可能沒有返回有效的 JSON
                    throw new Error("Apps Script 回應格式錯誤或無效。");
                }


                if (result.result === 'success') {
                    showMessage('報名成功！資料已送出。', 'success');
                    form.reset(); // 清空表單
                } else {
                    // 處理 Apps Script 返回的錯誤訊息
                    throw new Error(`Apps Script 錯誤: ${result.message}`);
                }

            } catch (error) {
                // 捕獲所有錯誤並顯示
                console.error("Submission error:", error);
                showMessage(`提交失敗：${error.message}`, 'error');
            } finally {
                // 無論成功或失敗，都恢復按鈕狀態
                submitButton.disabled = false;
                submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
                loadingMessage.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
